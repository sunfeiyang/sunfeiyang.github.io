{"title":"MongoDB安装和可视化工具以及数据备份与恢复","num_read":1493,"num_like":569,"num_collection":616,"num_comments":183,"slug":"resource-DB-MongoDB-MongoDB-copy","date":"2021-04-21T16:00:00.000Z","img":"/img/header_img/DB/mongodb.jpg","_id":"clhrbp2ao000co5lghcvw3n3k","project":"DB","site":{"data":{}},"updated":"2022-09-20T01:18:56.276Z","comments":true,"path":"api/articles/resource-DB-MongoDB-MongoDB-copy.json","webPath":"2021/04/22/resource-DB-MongoDB-MongoDB-copy/","permalink":"https://sunfy9.gitee.io/2021/04/22/resource-DB-MongoDB-MongoDB-copy/","excerpt":"MongoDB 备份(mongodump)与恢复(mongorestore)","covers":["../../../../img/MongoDB-copy/image-20211104222525295.png","../../../../img/MongoDB-copy/image-20211104222553188.png","../../../../img/MongoDB-copy/image-20211104222218818.png","../../../../img/MongoDB-copy/image-20210421152454424.png","../../../../img/MongoDB-copy/image-20210421152626286.png","../../../../img/MongoDB-copy/image-20210421152711232.png"],"keywords":"sunfy, hexo-theme-snail","content":"<p>MongoDB 备份(mongodump)与恢复(mongorestore)<a id=\"more\"></a></p>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mongodb的官网是https:&#x2F;&#x2F;www.mongodb.com</span><br><span class=\"line\">https:&#x2F;&#x2F;www.mongodb.com&#x2F;download-center&#x2F;community（官方）</span><br><span class=\"line\">https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;mongodb&#x2F;yum&#x2F;el7-4.2&#x2F;RPMS&#x2F;（清华）</span><br><span class=\"line\">https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;mongodb&#x2F;yum&#x2F;redhat&#x2F;7&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;RPMS&#x2F;（阿里）</span><br></pre></td></tr></table></figure>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222525295.png\" alt=\"image-20211104222525295\"></p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222553188.png\" alt=\"image-20211104222553188\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;mongodb&#x2F;yum&#x2F;redhat&#x2F;7&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;RPMS&#x2F;上面文件名字</span><br></pre></td></tr></table></figure>\n<p>安装完之后，是一个服务。 服务名字mongod.service</p>\n<blockquote>\n<p>systemctl enable mongod.service<br>systemctl start mongod.service</p>\n</blockquote>\n<h3 id=\"MongoDB-Compass\"><a href=\"#MongoDB-Compass\" class=\"headerlink\" title=\"MongoDB Compass\"></a>MongoDB Compass</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">地址：[https:&#x2F;&#x2F;www.mongodb.com&#x2F;download-center&#x2F;compass](https:&#x2F;&#x2F;links.jianshu.com&#x2F;go?to&#x3D;https%3A%2F%2Fwww.mongodb.com%2Fdownload-center%2Fcompass)。</span><br></pre></td></tr></table></figure>\n<p>同样的可以选择对应的版本下载并根据步骤安装</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222218818.png\" alt=\"image-20211104222218818\"></p>\n<h3 id=\"MongoDB数据备份\"><a href=\"#MongoDB数据备份\" class=\"headerlink\" title=\"MongoDB数据备份\"></a>MongoDB数据备份</h3><p>在Mongodb中我们使用mongodump命令来备份MongoDB数据。该命令可以导出所有数据到指定目录中。</p>\n<p>mongodump命令可以通过参数指定导出的数据量级转存的服务器。</p>\n<h4 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p>mongodump命令脚本语法如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;mongodump -h dbhost -d dbname -o dbdirectory</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>-h：</p>\n<p>MongoDB 所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</p>\n</li>\n<li><p>-d：</p>\n<p>需要备份的数据库实例，例如：test</p>\n</li>\n<li><p>-o：</p>\n<p>备份的数据存放位置，例如：c:\\data\\dump，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个test目录，这个目录里面存放该数据库实例的备份数据。</p>\n</li>\n</ul>\n<h4 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h4><p>在本地使用 27017 启动你的mongod服务。打开命令提示符窗口，进入MongoDB安装目录的bin目录输入命令mongodump:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodump -h 192.168.1.24:27017 -d cost -o /media/sunfy/project/</span><br></pre></td></tr></table></figure>\n<p>导出过程中可能会出现如下错误：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152454424.png\" alt=\"image-20210421152454424\"></p>\n<p>此问题的原因是因为本机mongo版本同服务器版本不一致导致，添加<code>--forceTableScan</code>问题解决</p>\n<p>导出成功截图：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152626286.png\" alt=\"image-20210421152626286\"></p>\n<p>mongodump 命令可选参数列表如下所示：</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">语法</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">实例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">mongodump —host HOST_NAME —port PORT_NUMBER</td>\n<td style=\"text-align:left\">该命令将备份所有MongoDB数据</td>\n<td style=\"text-align:left\">mongodump —host runoob.com —port 27017</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mongodump —dbpath DB_PATH —out BACKUP_DIRECTORY</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">mongodump —dbpath /data/db/ —out /data/backup/</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mongodump —collection COLLECTION —db DB_NAME</td>\n<td style=\"text-align:left\">该命令将备份指定数据库的集合。</td>\n<td style=\"text-align:left\">mongodump —collection mycol —db test</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<h3 id=\"MongoDB数据恢复\"><a href=\"#MongoDB数据恢复\" class=\"headerlink\" title=\"MongoDB数据恢复\"></a>MongoDB数据恢复</h3><p>mongodb使用 mongorestore 命令来恢复备份的数据。</p>\n<h4 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p>mongorestore命令脚本语法如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;mongorestore -h &lt;hostname&gt;&lt;:port&gt; -d dbname &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>—host &lt;:port&gt;, -h &lt;:port&gt;：</p>\n<p>MongoDB所在服务器地址，默认为： localhost:27017</p>\n</li>\n<li><p>—db , -d ：</p>\n<p>需要恢复的数据库实例，例如：test，当然这个名称也可以和备份时候的不一样，比如test2</p>\n</li>\n<li><p>—drop：</p>\n<p>恢复的时候，先删除当前数据，然后恢复备份的数据。就是说，恢复后，备份后添加修改的数据都会被删除，慎用哦！</p>\n</li>\n<li><p><path>：</p>\n<p>mongorestore 最后的一个参数，设置备份数据所在位置，例如：c:\\data\\dump\\test。</p>\n<p>你不能同时指定 <path> 和 —dir 选项，—dir也可以设置备份目录。</p>\n</li>\n<li><p>—dir：</p>\n<p>指定备份的目录</p>\n<p>你不能同时指定 <path> 和 —dir 选项。</p>\n</li>\n</ul>\n<p>接下来我们执行以下命令:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongorestore -h 192.168.1.161:27017 -d cost &#x2F;media&#x2F;sunfy&#x2F;project&#x2F;cost&#x2F;</span><br></pre></td></tr></table></figure>\n<p>执行以上命令输出结果如下：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152711232.png\" alt=\"image-20210421152711232\"></p>\n","more":"</p>\n<h3 id=\"下载\"><a href=\"#下载\" class=\"headerlink\" title=\"下载\"></a>下载</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mongodb的官网是https:&#x2F;&#x2F;www.mongodb.com</span><br><span class=\"line\">https:&#x2F;&#x2F;www.mongodb.com&#x2F;download-center&#x2F;community（官方）</span><br><span class=\"line\">https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;mongodb&#x2F;yum&#x2F;el7-4.2&#x2F;RPMS&#x2F;（清华）</span><br><span class=\"line\">https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;mongodb&#x2F;yum&#x2F;redhat&#x2F;7&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;RPMS&#x2F;（阿里）</span><br></pre></td></tr></table></figure>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222525295.png\" alt=\"image-20211104222525295\"></p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222553188.png\" alt=\"image-20211104222553188\"></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;mongodb&#x2F;yum&#x2F;redhat&#x2F;7&#x2F;mongodb-org&#x2F;4.2&#x2F;x86_64&#x2F;RPMS&#x2F;上面文件名字</span><br></pre></td></tr></table></figure>\n<p>安装完之后，是一个服务。 服务名字mongod.service</p>\n<blockquote>\n<p>systemctl enable mongod.service<br>systemctl start mongod.service</p>\n</blockquote>\n<h3 id=\"MongoDB-Compass\"><a href=\"#MongoDB-Compass\" class=\"headerlink\" title=\"MongoDB Compass\"></a>MongoDB Compass</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">地址：[https:&#x2F;&#x2F;www.mongodb.com&#x2F;download-center&#x2F;compass](https:&#x2F;&#x2F;links.jianshu.com&#x2F;go?to&#x3D;https%3A%2F%2Fwww.mongodb.com%2Fdownload-center%2Fcompass)。</span><br></pre></td></tr></table></figure>\n<p>同样的可以选择对应的版本下载并根据步骤安装</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20211104222218818.png\" alt=\"image-20211104222218818\"></p>\n<h3 id=\"MongoDB数据备份\"><a href=\"#MongoDB数据备份\" class=\"headerlink\" title=\"MongoDB数据备份\"></a>MongoDB数据备份</h3><p>在Mongodb中我们使用mongodump命令来备份MongoDB数据。该命令可以导出所有数据到指定目录中。</p>\n<p>mongodump命令可以通过参数指定导出的数据量级转存的服务器。</p>\n<h4 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p>mongodump命令脚本语法如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;mongodump -h dbhost -d dbname -o dbdirectory</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>-h：</p>\n<p>MongoDB 所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</p>\n</li>\n<li><p>-d：</p>\n<p>需要备份的数据库实例，例如：test</p>\n</li>\n<li><p>-o：</p>\n<p>备份的数据存放位置，例如：c:\\data\\dump，当然该目录需要提前建立，在备份完成后，系统自动在dump目录下建立一个test目录，这个目录里面存放该数据库实例的备份数据。</p>\n</li>\n</ul>\n<h4 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h4><p>在本地使用 27017 启动你的mongod服务。打开命令提示符窗口，进入MongoDB安装目录的bin目录输入命令mongodump:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongodump -h 192.168.1.24:27017 -d cost -o /media/sunfy/project/</span><br></pre></td></tr></table></figure>\n<p>导出过程中可能会出现如下错误：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152454424.png\" alt=\"image-20210421152454424\"></p>\n<p>此问题的原因是因为本机mongo版本同服务器版本不一致导致，添加<code>--forceTableScan</code>问题解决</p>\n<p>导出成功截图：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152626286.png\" alt=\"image-20210421152626286\"></p>\n<p>mongodump 命令可选参数列表如下所示：</p>\n<div class=\"table-container\">\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">语法</th>\n<th style=\"text-align:left\">描述</th>\n<th style=\"text-align:left\">实例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">mongodump —host HOST_NAME —port PORT_NUMBER</td>\n<td style=\"text-align:left\">该命令将备份所有MongoDB数据</td>\n<td style=\"text-align:left\">mongodump —host runoob.com —port 27017</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mongodump —dbpath DB_PATH —out BACKUP_DIRECTORY</td>\n<td style=\"text-align:left\"></td>\n<td style=\"text-align:left\">mongodump —dbpath /data/db/ —out /data/backup/</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">mongodump —collection COLLECTION —db DB_NAME</td>\n<td style=\"text-align:left\">该命令将备份指定数据库的集合。</td>\n<td style=\"text-align:left\">mongodump —collection mycol —db test</td>\n</tr>\n</tbody>\n</table>\n</div>\n<hr>\n<h3 id=\"MongoDB数据恢复\"><a href=\"#MongoDB数据恢复\" class=\"headerlink\" title=\"MongoDB数据恢复\"></a>MongoDB数据恢复</h3><p>mongodb使用 mongorestore 命令来恢复备份的数据。</p>\n<h4 id=\"语法-1\"><a href=\"#语法-1\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p>mongorestore命令脚本语法如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;mongorestore -h &lt;hostname&gt;&lt;:port&gt; -d dbname &lt;path&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>—host &lt;:port&gt;, -h &lt;:port&gt;：</p>\n<p>MongoDB所在服务器地址，默认为： localhost:27017</p>\n</li>\n<li><p>—db , -d ：</p>\n<p>需要恢复的数据库实例，例如：test，当然这个名称也可以和备份时候的不一样，比如test2</p>\n</li>\n<li><p>—drop：</p>\n<p>恢复的时候，先删除当前数据，然后恢复备份的数据。就是说，恢复后，备份后添加修改的数据都会被删除，慎用哦！</p>\n</li>\n<li><p><path>：</p>\n<p>mongorestore 最后的一个参数，设置备份数据所在位置，例如：c:\\data\\dump\\test。</p>\n<p>你不能同时指定 <path> 和 —dir 选项，—dir也可以设置备份目录。</p>\n</li>\n<li><p>—dir：</p>\n<p>指定备份的目录</p>\n<p>你不能同时指定 <path> 和 —dir 选项。</p>\n</li>\n</ul>\n<p>接下来我们执行以下命令:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mongorestore -h 192.168.1.161:27017 -d cost &#x2F;media&#x2F;sunfy&#x2F;project&#x2F;cost&#x2F;</span><br></pre></td></tr></table></figure>\n<p>执行以上命令输出结果如下：</p>\n<p><img src=\"../../../../img/MongoDB-copy/image-20210421152711232.png\" alt=\"image-20210421152711232\"></p>","next":{"title":"基于docker 搭建Prometheus+Grafana","path":"api/articles/resource-RPC-Docker-Centos-Docker-Prometheus-Grafana.json","image":"/img/header_img/docker/docker.jpg","num_read":328,"num_like":998,"num_collection":34,"num_comments":42},"prev":{"title":"Windows服务器定时任务执行","path":"api/articles/resource-system-Windows-windows-timer.json","image":"/img/header_img/windows/timer1.gif","num_read":1865,"num_like":474,"num_collection":472,"num_comments":91},"categories":[{"name":"数据库","path":"api/categories/数据库.json","pathContent":"api/categories/数据库","description":"结构化存储格式+事务和并发控制+内存管理+SQL访问接口","cover":"https://sunfy9.gitee.io/project/photo/project/db.jpg"}],"tags":[{"name":"MongoDB","path":"api/tags/MongoDB.json","pathContent":"api/tags/MongoDB","description":"[MongoDB]暂未设置说明","cover":"https://sunfy9.gitee.io/img/header_img/sunfy-default.png"}]}