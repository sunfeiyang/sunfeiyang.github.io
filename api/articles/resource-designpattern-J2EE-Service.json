{"title":"java设计模式之服务定位器模式","num_read":1118,"num_like":283,"num_collection":464,"num_comments":92,"slug":"resource-designpattern-J2EE-Service","date":"2020-10-11T16:00:00.000Z","img":"/img/header_img/Design/Service.png","_id":"clhrbp2b6004ko5lg0xwg5ls1","project":"designPattern","site":{"data":{}},"updated":"2022-09-20T01:35:31.960Z","author":"Sunfy","comments":true,"path":"api/articles/resource-designpattern-J2EE-Service.json","webPath":"2020/10/12/resource-designpattern-J2EE-Service/","permalink":"https://sunfy9.gitee.io/2020/10/12/resource-designpattern-J2EE-Service/","excerpt":null,"covers":["../../../../img/Service/20201015-service-locator.svg"],"keywords":"sunfy, hexo-theme-snail","content":"<p>服务定位器模式（Service Locator Pattern）用在我们想使用 JNDI 查询定位各种服务的时候。考虑到为某个服务查找 JNDI 的代价很高，服务定位器模式充分利用了缓存技术。在首次请求某个服务时，服务定位器在 JNDI 中查找服务，并缓存该服务对象。当再次请求相同的服务时，服务定位器会在它的缓存中查找，这样可以在很大程度上提高应用程序的性能。以下是这种设计模式的实体。</p>\n<ul>\n<li><strong>服务（Service）</strong> - 实际处理请求的服务。对这种服务的引用可以在 JNDI 服务器中查找到。</li>\n<li><strong>Context / 初始的 Context</strong> - JNDI Context 带有对要查找的服务的引用。</li>\n<li><strong>服务定位器（Service Locator）</strong> - 服务定位器是通过 JNDI 查找和缓存服务来获取服务的单点接触。</li>\n<li><strong>缓存（Cache）</strong> - 缓存存储服务的引用，以便复用它们。</li>\n<li><strong>客户端（Client）</strong> - Client 是通过 ServiceLocator 调用服务的对象。</li>\n</ul>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现<sunfy-line></h2><p>我们将创建 <em>ServiceLocator</em>、<em>InitialContext</em>、<em>Cache</em>、<em>Service</em> 作为表示实体的各种对象。<em>Service1</em> 和 <em>Service2</em> 表示实体服务。</p>\n<p><em>ServiceLocatorPatternDemo</em> 类在这里是作为一个客户端，将使用 <em>ServiceLocator</em> 来演示服务定位器设计模式。</p>\n<p><img src=\"../../../../img/Service/20201015-service-locator.svg\" alt=\"服务定位器模式的 UML 图\"></p>\n<h3 id=\"步骤-1\"><a href=\"#步骤-1\" class=\"headerlink\" title=\"步骤 1\"></a>步骤 1</h3><p>创建服务接口 Service。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-2\"><a href=\"#步骤-2\" class=\"headerlink\" title=\"步骤 2\"></a>步骤 2</h3><p>创建实体服务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Executing Service1\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"meta\">@Override</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"Service1\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Executing Service2\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"meta\">@Override</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"Service2\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-3\"><a href=\"#步骤-3\" class=\"headerlink\" title=\"步骤 3\"></a>步骤 3</h3><p>为 JNDI 查询创建 InitialContext。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InitialContext</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">lookup</span><span class=\"params\">(String jndiName)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(jndiName.equalsIgnoreCase(<span class=\"string\">\"SERVICE1\"</span>))&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">\"Looking up and creating a new Service1 object\"</span>);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Service1();</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (jndiName.equalsIgnoreCase(<span class=\"string\">\"SERVICE2\"</span>))&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">\"Looking up and creating a new Service2 object\"</span>);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Service2();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;      </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-4\"><a href=\"#步骤-4\" class=\"headerlink\" title=\"步骤 4\"></a>步骤 4</h3><p>创建缓存 Cache。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cache</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"keyword\">private</span> List&lt;Service&gt; services;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Cache</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      services = <span class=\"keyword\">new</span> ArrayList&lt;Service&gt;();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Service <span class=\"title\">getService</span><span class=\"params\">(String serviceName)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Service service : services) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(service.getName().equalsIgnoreCase(serviceName))&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Returning cached  \"</span>+serviceName+<span class=\"string\">\" object\"</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> service;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addService</span><span class=\"params\">(Service newService)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">boolean</span> exists = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Service service : services) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(service.getName().equalsIgnoreCase(newService.getName()))&#123;</span><br><span class=\"line\">            exists = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(!exists)&#123;</span><br><span class=\"line\">         services.add(newService);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-5\"><a href=\"#步骤-5\" class=\"headerlink\" title=\"步骤 5\"></a>步骤 5</h3><p>创建服务定位器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceLocator</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Cache cache;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">      cache = <span class=\"keyword\">new</span> Cache();    </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Service <span class=\"title\">getService</span><span class=\"params\">(String jndiName)</span></span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">      Service service = cache.getService(jndiName);</span><br><span class=\"line\"> </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(service != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> service;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">      InitialContext context = <span class=\"keyword\">new</span> InitialContext();</span><br><span class=\"line\">      Service service1 = (Service)context.lookup(jndiName);</span><br><span class=\"line\">      cache.addService(service1);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> service1;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-6\"><a href=\"#步骤-6\" class=\"headerlink\" title=\"步骤 6\"></a>步骤 6</h3><p>使用 <em>ServiceLocator</em> 来演示服务定位器设计模式。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceLocatorPatternDemo</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">      Service service = ServiceLocator.getService(<span class=\"string\">\"Service1\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service2\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service1\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service2\"</span>);</span><br><span class=\"line\">      service.execute();      </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-7\"><a href=\"#步骤-7\" class=\"headerlink\" title=\"步骤 7\"></a>步骤 7</h3><p>执行程序，输出结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Looking up and creating a new Service1 object</span><br><span class=\"line\">Executing Service1</span><br><span class=\"line\">Looking up and creating a new Service2 object</span><br><span class=\"line\">Executing Service2</span><br><span class=\"line\">Returning cached  Service1 object</span><br><span class=\"line\">Executing Service1</span><br><span class=\"line\">Returning cached  Service2 object</span><br><span class=\"line\">Executing Service2</span><br></pre></td></tr></table></figure>\n","more":"<p>服务定位器模式（Service Locator Pattern）用在我们想使用 JNDI 查询定位各种服务的时候。考虑到为某个服务查找 JNDI 的代价很高，服务定位器模式充分利用了缓存技术。在首次请求某个服务时，服务定位器在 JNDI 中查找服务，并缓存该服务对象。当再次请求相同的服务时，服务定位器会在它的缓存中查找，这样可以在很大程度上提高应用程序的性能。以下是这种设计模式的实体。</p>\n<ul>\n<li><strong>服务（Service）</strong> - 实际处理请求的服务。对这种服务的引用可以在 JNDI 服务器中查找到。</li>\n<li><strong>Context / 初始的 Context</strong> - JNDI Context 带有对要查找的服务的引用。</li>\n<li><strong>服务定位器（Service Locator）</strong> - 服务定位器是通过 JNDI 查找和缓存服务来获取服务的单点接触。</li>\n<li><strong>缓存（Cache）</strong> - 缓存存储服务的引用，以便复用它们。</li>\n<li><strong>客户端（Client）</strong> - Client 是通过 ServiceLocator 调用服务的对象。</li>\n</ul>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现<sunfy-line></h2><p>我们将创建 <em>ServiceLocator</em>、<em>InitialContext</em>、<em>Cache</em>、<em>Service</em> 作为表示实体的各种对象。<em>Service1</em> 和 <em>Service2</em> 表示实体服务。</p>\n<p><em>ServiceLocatorPatternDemo</em> 类在这里是作为一个客户端，将使用 <em>ServiceLocator</em> 来演示服务定位器设计模式。</p>\n<p><img src=\"../../../../img/Service/20201015-service-locator.svg\" alt=\"服务定位器模式的 UML 图\"></p>\n<h3 id=\"步骤-1\"><a href=\"#步骤-1\" class=\"headerlink\" title=\"步骤 1\"></a>步骤 1</h3><p>创建服务接口 Service。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-2\"><a href=\"#步骤-2\" class=\"headerlink\" title=\"步骤 2\"></a>步骤 2</h3><p>创建实体服务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service1</span> <span class=\"keyword\">implements</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Executing Service1\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"meta\">@Override</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"Service1\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Service2</span> <span class=\"keyword\">implements</span> <span class=\"title\">Service</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">execute</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">\"Executing Service2\"</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"meta\">@Override</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">getName</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"Service2\"</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-3\"><a href=\"#步骤-3\" class=\"headerlink\" title=\"步骤 3\"></a>步骤 3</h3><p>为 JNDI 查询创建 InitialContext。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InitialContext</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">lookup</span><span class=\"params\">(String jndiName)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(jndiName.equalsIgnoreCase(<span class=\"string\">\"SERVICE1\"</span>))&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">\"Looking up and creating a new Service1 object\"</span>);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Service1();</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (jndiName.equalsIgnoreCase(<span class=\"string\">\"SERVICE2\"</span>))&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">\"Looking up and creating a new Service2 object\"</span>);</span><br><span class=\"line\">         <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Service2();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;      </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-4\"><a href=\"#步骤-4\" class=\"headerlink\" title=\"步骤 4\"></a>步骤 4</h3><p>创建缓存 Cache。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cache</span> </span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"keyword\">private</span> List&lt;Service&gt; services;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">Cache</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      services = <span class=\"keyword\">new</span> ArrayList&lt;Service&gt;();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> Service <span class=\"title\">getService</span><span class=\"params\">(String serviceName)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Service service : services) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(service.getName().equalsIgnoreCase(serviceName))&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">\"Returning cached  \"</span>+serviceName+<span class=\"string\">\" object\"</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> service;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addService</span><span class=\"params\">(Service newService)</span></span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">boolean</span> exists = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Service service : services) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span>(service.getName().equalsIgnoreCase(newService.getName()))&#123;</span><br><span class=\"line\">            exists = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(!exists)&#123;</span><br><span class=\"line\">         services.add(newService);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-5\"><a href=\"#步骤-5\" class=\"headerlink\" title=\"步骤 5\"></a>步骤 5</h3><p>创建服务定位器。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceLocator</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Cache cache;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">      cache = <span class=\"keyword\">new</span> Cache();    </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Service <span class=\"title\">getService</span><span class=\"params\">(String jndiName)</span></span>&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">      Service service = cache.getService(jndiName);</span><br><span class=\"line\"> </span><br><span class=\"line\">      <span class=\"keyword\">if</span>(service != <span class=\"keyword\">null</span>)&#123;</span><br><span class=\"line\">         <span class=\"keyword\">return</span> service;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">      InitialContext context = <span class=\"keyword\">new</span> InitialContext();</span><br><span class=\"line\">      Service service1 = (Service)context.lookup(jndiName);</span><br><span class=\"line\">      cache.addService(service1);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> service1;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-6\"><a href=\"#步骤-6\" class=\"headerlink\" title=\"步骤 6\"></a>步骤 6</h3><p>使用 <em>ServiceLocator</em> 来演示服务定位器设计模式。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ServiceLocatorPatternDemo</span> </span>&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">      Service service = ServiceLocator.getService(<span class=\"string\">\"Service1\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service2\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service1\"</span>);</span><br><span class=\"line\">      service.execute();</span><br><span class=\"line\">      service = ServiceLocator.getService(<span class=\"string\">\"Service2\"</span>);</span><br><span class=\"line\">      service.execute();      </span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"步骤-7\"><a href=\"#步骤-7\" class=\"headerlink\" title=\"步骤 7\"></a>步骤 7</h3><p>执行程序，输出结果：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Looking up and creating a new Service1 object</span><br><span class=\"line\">Executing Service1</span><br><span class=\"line\">Looking up and creating a new Service2 object</span><br><span class=\"line\">Executing Service2</span><br><span class=\"line\">Returning cached  Service1 object</span><br><span class=\"line\">Executing Service1</span><br><span class=\"line\">Returning cached  Service2 object</span><br><span class=\"line\">Executing Service2</span><br></pre></td></tr></table></figure>\n","next":{"title":"java设计模式之拦截过滤器模式","path":"api/articles/resource-designpattern-J2EE-Intercepting.json","image":"/img/header_img/Design/Intercepting.png","num_read":1661,"num_like":254,"num_collection":546,"num_comments":180},"prev":{"title":"java设计模式之数据访问对象模式","path":"api/articles/resource-designpattern-J2EE-DataAccess.json","image":"/img/header_img/Design/DataAccess.png","num_read":977,"num_like":668,"num_collection":526,"num_comments":36},"categories":[{"name":"设计模式","path":"api/categories/设计模式.json","pathContent":"api/categories/设计模式","description":"简单快捷、解决方案","cover":"https://sunfy9.gitee.io/project/photo/project/design.jpg"}],"tags":[]}