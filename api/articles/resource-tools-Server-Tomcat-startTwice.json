{"title":"Tomcat下项目被启动两次为问题","num_read":1753,"num_like":929,"num_collection":346,"num_comments":103,"slug":"resource-tools-Server-Tomcat-startTwice","date":"2019-05-11T16:00:00.000Z","img":"/img/header_img/server/startTwice.png","_id":"clhrbp2i500llo5lg2hsl7id9","site":{"data":{}},"updated":"2022-09-20T02:45:18.528Z","comments":true,"path":"api/articles/resource-tools-Server-Tomcat-startTwice.json","webPath":"2019/05/12/resource-tools-Server-Tomcat-startTwice/","permalink":"https://sunfy9.gitee.io/2019/05/12/resource-tools-Server-Tomcat-startTwice/","excerpt":"在tomcat下启动项目时自己写的定时程序被执行了两次，导致程序启动了两个线程，使定时任务在几秒间隔内执行了两次，后来通过日志查到，原来是tomcat将项目启动了两次，为什么呢？","covers":null,"keywords":"sunfy, hexo-theme-snail","content":"<p>在tomcat下启动项目时自己写的定时程序被执行了两次，导致程序启动了两个线程，使定时任务在几秒间隔内执行了两次，后来通过日志查到，原来是tomcat将项目启动了两次，为什么呢？<a id=\"more\"></a></p>\n<p>问题原因是由于tomcat下配置的问题；为了让程序可以通过域名直接访问，而不用输入项目名，所有要对tomcat配置项目的映射，由于客户那里配置的有问题所有导致程序启动两次。</p>\n<p>错误配置：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Host</span> <span class=\"attr\">name</span>=<span class=\"string\">\"localhost\"</span> <span class=\"attr\">appBase</span>=<span class=\"string\">\"webapps\"</span> <span class=\"attr\">unpackWARs</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">autoDeploy</span>=<span class=\"string\">\"true\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlValidation</span>=<span class=\"string\">\"false\"</span> <span class=\"attr\">xmlNamespaceAware</span>=<span class=\"string\">\"false\"</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"/admin\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>以上配置，由于host节点配置了appBase为webapps，所有tomcat会加载webapps里的所有项目，下面又配置了webapps里的项目，导致项目又加载一次，所以会导致项目重复加载，定时程序会在几秒之内重复执行，后来改了一下配置好了，</p>\n<p>如下正确配置：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Host</span> <span class=\"attr\">name</span>=<span class=\"string\">\"localhost\"</span> <span class=\"attr\">appBase</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">unpackWARs</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">autoDeploy</span>=<span class=\"string\">\"true\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlValidation</span>=<span class=\"string\">\"false\"</span> <span class=\"attr\">xmlNamespaceAware</span>=<span class=\"string\">\"false\"</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"/admin\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>","more":"</p>\n<p>问题原因是由于tomcat下配置的问题；为了让程序可以通过域名直接访问，而不用输入项目名，所有要对tomcat配置项目的映射，由于客户那里配置的有问题所有导致程序启动两次。</p>\n<p>错误配置：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Host</span> <span class=\"attr\">name</span>=<span class=\"string\">\"localhost\"</span> <span class=\"attr\">appBase</span>=<span class=\"string\">\"webapps\"</span> <span class=\"attr\">unpackWARs</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">autoDeploy</span>=<span class=\"string\">\"true\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlValidation</span>=<span class=\"string\">\"false\"</span> <span class=\"attr\">xmlNamespaceAware</span>=<span class=\"string\">\"false\"</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"/admin\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>以上配置，由于host节点配置了appBase为webapps，所有tomcat会加载webapps里的所有项目，下面又配置了webapps里的项目，导致项目又加载一次，所以会导致项目重复加载，定时程序会在几秒之内重复执行，后来改了一下配置好了，</p>\n<p>如下正确配置：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Host</span> <span class=\"attr\">name</span>=<span class=\"string\">\"localhost\"</span> <span class=\"attr\">appBase</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">unpackWARs</span>=<span class=\"string\">\"true\"</span> <span class=\"attr\">autoDeploy</span>=<span class=\"string\">\"true\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">    <span class=\"attr\">xmlValidation</span>=<span class=\"string\">\"false\"</span> <span class=\"attr\">xmlNamespaceAware</span>=<span class=\"string\">\"false\"</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Context</span> <span class=\"attr\">docBase</span>=<span class=\"string\">\"/usr/local/apache-tomcat-6.0.29/webapps/XXX\"</span>  </span></span><br><span class=\"line\"><span class=\"tag\">        <span class=\"attr\">path</span>=<span class=\"string\">\"/admin\"</span> <span class=\"attr\">reloadable</span>=<span class=\"string\">\"true\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Context</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>","next":{"title":"Linux系统之间传输文件的几种方法","path":"api/articles/resource-system-Linux-Linux-file.json","image":"/img/header_img/15.gif","num_read":402,"num_like":580,"num_collection":279,"num_comments":45},"prev":{"title":"常用技术链接","path":"api/articles/resource-tools-other-link.json","image":"/img/header_img/16.gif","num_read":1422,"num_like":434,"num_collection":445,"num_comments":36},"categories":[{"name":"应用服务器","path":"api/categories/应用服务器.json","pathContent":"api/categories/应用服务器","description":"一种具有一定逻辑关系，在计算机中应用某种存储结构，并且封装了相应操作的数据元素集合。","cover":"https://sunfy9.gitee.io/project/photo/project/server.jpg"}],"tags":[{"name":"Tomcat","path":"api/tags/Tomcat.json","pathContent":"api/tags/Tomcat","description":"[Tomcat]暂未设置说明","cover":"https://sunfy9.gitee.io/img/header_img/sunfy-default.png"}]}