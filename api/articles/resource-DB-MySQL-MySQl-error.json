{"title":"MySQL常见异常","num_read":768,"num_like":832,"num_collection":885,"num_comments":85,"slug":"resource-DB-MySQL-MySQl-error","date":"2020-09-21T16:00:00.000Z","img":"/img/header_img/DB/mysql.jpg","_id":"clhrbp2ar000xo5lg6x3m548a","project":"DB","subtitle":"mySQL数据库在使用过程中遇到的一些问题记录","site":{"data":{}},"updated":"2022-05-29T08:28:38.000Z","comments":true,"path":"api/articles/resource-DB-MySQL-MySQl-error.json","webPath":"2020/09/22/resource-DB-MySQL-MySQl-error/","permalink":"https://sunfy9.gitee.io/2020/09/22/resource-DB-MySQL-MySQl-error/","excerpt":"mySQL数据库在使用过程中遇到的一些问题记录","covers":null,"keywords":"sunfy, hexo-theme-snail","content":"<p>mySQL数据库在使用过程中遇到的一些问题记录<a id=\"more\"></a></p>\n<h2 id=\"linux，登录mysql报错\"><a href=\"#linux，登录mysql报错\" class=\"headerlink\" title=\"linux，登录mysql报错\"></a>linux，登录mysql报错</h2><p>ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘/var/lib/mysql.sock’</p>\n<p>首先检查/etc下的是否有my.cnf文件,这是启动时基本配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">log-bin&#x3D;mysql-bin</span><br><span class=\"line\">server-id&#x3D;1</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # and set to the amount of RAM for the most important data</span><br><span class=\"line\"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span><br><span class=\"line\">innodb_buffer_pool_size &#x3D; 8M</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to turn on a very important data integrity option: logging</span><br><span class=\"line\"># changes to the binary log between backups.</span><br><span class=\"line\"># log_bin</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to set options mainly useful for reporting servers.</span><br><span class=\"line\"># The server defaults are faster for transactions and fast SELECTs.</span><br><span class=\"line\"># Adjust sizes as needed, experiment to find the optimal values.</span><br><span class=\"line\">join_buffer_size &#x3D; 8M</span><br><span class=\"line\">sort_buffer_size &#x3D; 2M</span><br><span class=\"line\">read_rnd_buffer_size &#x3D; 2M</span><br><span class=\"line\">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class=\"line\">log-bin</span><br><span class=\"line\">max_binlog_size&#x3D;50M</span><br><span class=\"line\">expire_logs_days&#x3D;7</span><br><span class=\"line\"># 关闭所有网络链接,开启后只能使用mysql客户端链接</span><br><span class=\"line\">#skip-networking</span><br><span class=\"line\">#default-time-zone &#x3D; &#39;+8:00&#39;</span><br><span class=\"line\">performance_schema_max_table_instances&#x3D;200</span><br><span class=\"line\">table_definition_cache&#x3D;200</span><br><span class=\"line\">table_open_cache&#x3D;128</span><br><span class=\"line\">bind-address &#x3D; 0.0.0.0</span><br><span class=\"line\">#skip-grant-tables</span><br><span class=\"line\"></span><br><span class=\"line\"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class=\"line\">symbolic-links&#x3D;0</span><br><span class=\"line\"></span><br><span class=\"line\"># Recommended in standard MySQL setup</span><br><span class=\"line\">sql_mode&#x3D;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class=\"line\">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class=\"line\"></span><br><span class=\"line\">#配置开启binlog</span><br><span class=\"line\">log‐bin&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;mysql&#x2F;binlog&#x2F;mysql‐bin</span><br><span class=\"line\">##注意5.7以及更高版本需要配置本项:server‐id&#x3D;123454(自定义,保证唯一性);</span><br><span class=\"line\">###binlog格式,有3种statement,row,mixed</span><br><span class=\"line\">binlog‐format&#x3D;ROW</span><br><span class=\"line\">###表示每1次执行写入就与硬盘同步,会影响性能,为0时表示,事务提交时mysql不做刷盘操作,由系统决定</span><br><span class=\"line\">sync‐binlog&#x3D;1</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<p>关闭进程指令：ps aux |grep ‘mysql*’<br>关闭mysql的所有进程</p>\n<p>启动mysql: systemctl start mysqld</p>\n<h2 id=\"server-id问题\"><a href=\"#server-id问题\" class=\"headerlink\" title=\"server-id问题\"></a>server-id问题</h2><p>[ERROR] You have enabled the binary log, but you haven’t provided the mandatory server-id.</p>\n<p>报错的原因：</p>\n<p>在设置bin log日志的时候，没有设置server_id参数。server-id参数用于在复制中，为主库和备库提供一个独立的ID，以区分主库和备库；开启二进制文件的时候，需要设置这个参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@mysql bin]# vi &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">#add</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">log-bin&#x3D;mysql-bin</span><br><span class=\"line\">server-id&#x3D;1</span><br></pre></td></tr></table></figure>\n<h2 id=\"远程登录授权\"><a href=\"#远程登录授权\" class=\"headerlink\" title=\"远程登录授权\"></a>远程登录授权</h2><p>Access denied for user ‘root’@’%’ to database ‘XXXX’</p>\n<p>解决方法<br>最后发现是user表中’root’@’%’没有grant的权限<br>可以用如下命令查看： </p>\n<p>可以看到现在这两个权限都是N<br>然后我们更新它们为Y，然后重启mysql</p>\n<p>update mysql.user set Grant_priv=’Y’,Super_priv=’Y’ where user = ‘root’ and host = ‘%’;</p>\n<h2 id=\"mysql5-7简单密码错误\"><a href=\"#mysql5-7简单密码错误\" class=\"headerlink\" title=\"mysql5.7简单密码错误\"></a>mysql5.7简单密码错误</h2><p>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</p>\n<p>有时候，只是为了自己测试，不想密码设置得那么复杂，譬如只想设置root的密码为123456。</p>\n<p>SET PASSWORD FOR ‘root’@’localhost’ = PASSWORD(‘123456’);</p>\n<p>但是会报错：</p>\n<figure class=\"highlight delphi\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; <span class=\"keyword\">SET</span> PASSWORD <span class=\"keyword\">FOR</span> <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> = PASSWORD(<span class=\"string\">'123'</span>);</span><br><span class=\"line\">ERROR <span class=\"number\">1819</span> (HY000): Your password does <span class=\"keyword\">not</span> satisfy the current policy requirements</span><br></pre></td></tr></table></figure>\n<p>【原因】</p>\n<p>原来MySQL5.6.6版本之后增加了密码强度验证插件validate_password，相关参数设置的较为严格。<br>使用了该插件会检查设置的密码是否符合当前设置的强度规则，若不满足则拒绝设置。影响的语句和函数有：create user,grant,set password,password(),old password。<br>【解决】</p>\n<p>1） 查看mysql全局参数配置</p>\n<p>该问题其实与mysql的validate_password_policy的值有关。<br>查看一下msyql密码相关的几个全局参数：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select @@validate_password_policy;</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\">| @@validate_password_policy |</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\">| MEDIUM                     |</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">1 row in <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br><span class=\"line\">mysql&gt; <span class=\"keyword\">SHOW</span> <span class=\"keyword\">VARIABLES</span> <span class=\"keyword\">LIKE</span> <span class=\"string\">'validate_password%'</span>;</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\">| Variable_name                        | Value  |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\">| validate_password_dictionary_file    |        |</span><br><span class=\"line\">| validate_password_length             | 8      |</span><br><span class=\"line\">| validate_password_mixed_case_count   | 1      |</span><br><span class=\"line\">| validate_password_number_count       | 1      |</span><br><span class=\"line\">| validate_password_policy             | MEDIUM |</span><br><span class=\"line\">| validate_password_special_char_count | 1      |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">6 rows in <span class=\"keyword\">set</span> (<span class=\"number\">0.08</span> sec)</span><br></pre></td></tr></table></figure>\n<p>2）参数解释</p>\n<p>validate_password_dictionary_file<br>插件用于验证密码强度的字典文件路径。</p>\n<p>validate_password_length<br>密码最小长度，参数默认为8，它有最小值的限制，最小值为：validate_password_number_count + validate_password_special_char_count + (2 * validate_password_mixed_case_count)</p>\n<p>validate_password_mixed_case_count<br>密码至少要包含的小写字母个数和大写字母个数。</p>\n<p>validate_password_number_count<br>密码至少要包含的数字个数。</p>\n<p>validate_password_policy<br>密码强度检查等级，0/LOW、1/MEDIUM、2/STRONG。有以下取值：<br><strong>Policy         Tests Performed</strong><br>0 or LOW        Length<br>1 or MEDIUM     Length; numeric, lowercase/uppercase, and special characters<br>2 or STRONG     Length; numeric, lowercase/uppercase, and special characters; dictionary file<br>默认是1，即MEDIUM，所以刚开始设置的密码必须符合长度，且必须含有数字，小写或大写字母，特殊字符。</p>\n<p>validate_password_special_char_count<br>密码至少要包含的特殊字符数。</p>\n<p>3）修改mysql参数配置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; set global validate_password_policy=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.05 sec)</span><br><span class=\"line\">mysql&gt; </span><br><span class=\"line\">mysql&gt; set global validate_password_mixed_case_count=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_number_count=3;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_special_char_count=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_length=3;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; SHOW VARIABLES LIKE 'validate_password%';</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">| Variable_name                        | Value |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">| validate_password_dictionary_file    |       |</span><br><span class=\"line\">| validate_password_length             | 3     |</span><br><span class=\"line\">| validate_password_mixed_case_count   | 0     |</span><br><span class=\"line\">| validate_password_number_count       | 3     |</span><br><span class=\"line\">| validate_password_policy             | LOW   |</span><br><span class=\"line\">| validate_password_special_char_count | 0     |</span><br><span class=\"line\"></span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">6 rows in <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n<p>4）修改简单密码：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SET PASSWORD FOR 'root'@'localhost' = PASSWORD('123');</span><br><span class=\"line\">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>\n<h2 id=\"ERR-1273-Unknown-collation-‘utf8mb4-0900-ai-ci’\"><a href=\"#ERR-1273-Unknown-collation-‘utf8mb4-0900-ai-ci’\" class=\"headerlink\" title=\"[ERR] 1273 - Unknown collation: ‘utf8mb4_0900_ai_ci’\"></a>[ERR] 1273 - Unknown collation: ‘utf8mb4_0900_ai_ci’</h2><p>使用navicate12运行sql文件出错</p>\n<p>报错：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ERR] 1273 - Unknown collation: &#39;utf8mb4_0900_ai_ci&#39;</span><br></pre></td></tr></table></figure>\n<p>报错原因：<br>生成转储文件的数据库版本为8.0,要导入sql文件的数据库版本为5.6,因为是高版本导入到低版本，引起1273错误</p>\n<p>解决方法：<br>打开sql文件，将文件中的所有<br><code>utf8mb4_0900_ai_ci</code>替换为<code>utf8_general_ci</code><br><code>utf8mb4</code>替换为<code>utf8</code><br>保存后再次运行sql文件，运行成功</p>\n<h2 id=\"MySQL报错：Server-returns-invalid-timezone-Go-to-‘Advanced’-tab-and-set-‘serverTimezone’-property-manually\"><a href=\"#MySQL报错：Server-returns-invalid-timezone-Go-to-‘Advanced’-tab-and-set-‘serverTimezone’-property-manually\" class=\"headerlink\" title=\"MySQL报错：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.\"></a>MySQL报错：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.</h2><p>错误：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.<br>　　　　服务器返回无效时区。转到“高级”选项卡并手动设置“serverTimezone”属性。</p>\n<p>mysql -u root -p<br>mysql&gt;show variables like ‘%time_zone%’;<br>mysql&gt;set global time_zone=’+8:00’;</p>\n<p>问题：每次重启服务都要重新配置一遍。<br>解决：mysql&gt;set persist time_zone=’+8:00’;</p>\n<h2 id=\"mysql-报错：1140-In-aggregated-query-without-GROUP-BY-expression\"><a href=\"#mysql-报错：1140-In-aggregated-query-without-GROUP-BY-expression\" class=\"headerlink\" title=\"mysql 报错：1140 In aggregated query without GROUP BY, expression\"></a>mysql 报错：1140 In aggregated query without GROUP BY, expression</h2><p>1140 In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column ‘football.order.id’; this is incompatible with sql_mode=only_full_group_by<br>mysql5.7执行sql语句报错：In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column ‘football.order.id’; this is incompatible with sql_mode=only_full_group_by</p>\n<p>找了好久找到可行的办法分享下</p>\n<p>1.方法1，需要重启mysql服务</p>\n<p>编辑/etc/my.cnf文件，加入如下参数，重启mysql</p>\n<blockquote>\n<p>sql_mode = “STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER”</p>\n</blockquote>\n<p>2.方法2，不需要重启mysql服务</p>\n<p>可以看到模式为only_full_group_by</p>\n<p>mysql&gt;show variables like ‘%sql_mode’;</p>\n<p>mysql&gt; show session variables like ‘%sql_mode%’;</p>\n<p>mysql&gt; show global variables like ‘%sql_mode%’;</p>\n<p>使当前会话失效</p>\n<p>mysql&gt; set global sql_mode=’ ‘;</p>\n<p>mysql&gt; set session sql_mode=’ ‘;</p>\n","more":"</p>\n<h2 id=\"linux，登录mysql报错\"><a href=\"#linux，登录mysql报错\" class=\"headerlink\" title=\"linux，登录mysql报错\"></a>linux，登录mysql报错</h2><p>ERROR 2002 (HY000): Can’t connect to local MySQL server through socket ‘/var/lib/mysql.sock’</p>\n<p>首先检查/etc下的是否有my.cnf文件,这是启动时基本配置文件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">log-bin&#x3D;mysql-bin</span><br><span class=\"line\">server-id&#x3D;1</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # and set to the amount of RAM for the most important data</span><br><span class=\"line\"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span><br><span class=\"line\">innodb_buffer_pool_size &#x3D; 8M</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to turn on a very important data integrity option: logging</span><br><span class=\"line\"># changes to the binary log between backups.</span><br><span class=\"line\"># log_bin</span><br><span class=\"line\">#</span><br><span class=\"line\"># Remove leading # to set options mainly useful for reporting servers.</span><br><span class=\"line\"># The server defaults are faster for transactions and fast SELECTs.</span><br><span class=\"line\"># Adjust sizes as needed, experiment to find the optimal values.</span><br><span class=\"line\">join_buffer_size &#x3D; 8M</span><br><span class=\"line\">sort_buffer_size &#x3D; 2M</span><br><span class=\"line\">read_rnd_buffer_size &#x3D; 2M</span><br><span class=\"line\">datadir&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class=\"line\">socket&#x3D;&#x2F;var&#x2F;lib&#x2F;mysql&#x2F;mysql.sock</span><br><span class=\"line\">log-bin</span><br><span class=\"line\">max_binlog_size&#x3D;50M</span><br><span class=\"line\">expire_logs_days&#x3D;7</span><br><span class=\"line\"># 关闭所有网络链接,开启后只能使用mysql客户端链接</span><br><span class=\"line\">#skip-networking</span><br><span class=\"line\">#default-time-zone &#x3D; &#39;+8:00&#39;</span><br><span class=\"line\">performance_schema_max_table_instances&#x3D;200</span><br><span class=\"line\">table_definition_cache&#x3D;200</span><br><span class=\"line\">table_open_cache&#x3D;128</span><br><span class=\"line\">bind-address &#x3D; 0.0.0.0</span><br><span class=\"line\">#skip-grant-tables</span><br><span class=\"line\"></span><br><span class=\"line\"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class=\"line\">symbolic-links&#x3D;0</span><br><span class=\"line\"></span><br><span class=\"line\"># Recommended in standard MySQL setup</span><br><span class=\"line\">sql_mode&#x3D;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class=\"line\"></span><br><span class=\"line\">[mysqld_safe]</span><br><span class=\"line\">log-error&#x3D;&#x2F;var&#x2F;log&#x2F;mysqld.log</span><br><span class=\"line\">pid-file&#x3D;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.pid</span><br><span class=\"line\"></span><br><span class=\"line\">#配置开启binlog</span><br><span class=\"line\">log‐bin&#x3D;&#x2F;usr&#x2F;local&#x2F;software&#x2F;mysql&#x2F;binlog&#x2F;mysql‐bin</span><br><span class=\"line\">##注意5.7以及更高版本需要配置本项:server‐id&#x3D;123454(自定义,保证唯一性);</span><br><span class=\"line\">###binlog格式,有3种statement,row,mixed</span><br><span class=\"line\">binlog‐format&#x3D;ROW</span><br><span class=\"line\">###表示每1次执行写入就与硬盘同步,会影响性能,为0时表示,事务提交时mysql不做刷盘操作,由系统决定</span><br><span class=\"line\">sync‐binlog&#x3D;1</span><br><span class=\"line\">#</span><br></pre></td></tr></table></figure>\n<p>关闭进程指令：ps aux |grep ‘mysql*’<br>关闭mysql的所有进程</p>\n<p>启动mysql: systemctl start mysqld</p>\n<h2 id=\"server-id问题\"><a href=\"#server-id问题\" class=\"headerlink\" title=\"server-id问题\"></a>server-id问题</h2><p>[ERROR] You have enabled the binary log, but you haven’t provided the mandatory server-id.</p>\n<p>报错的原因：</p>\n<p>在设置bin log日志的时候，没有设置server_id参数。server-id参数用于在复制中，为主库和备库提供一个独立的ID，以区分主库和备库；开启二进制文件的时候，需要设置这个参数。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@mysql bin]# vi &#x2F;etc&#x2F;my.cnf</span><br><span class=\"line\">#add</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">log-bin&#x3D;mysql-bin</span><br><span class=\"line\">server-id&#x3D;1</span><br></pre></td></tr></table></figure>\n<h2 id=\"远程登录授权\"><a href=\"#远程登录授权\" class=\"headerlink\" title=\"远程登录授权\"></a>远程登录授权</h2><p>Access denied for user ‘root’@’%’ to database ‘XXXX’</p>\n<p>解决方法<br>最后发现是user表中’root’@’%’没有grant的权限<br>可以用如下命令查看： </p>\n<p>可以看到现在这两个权限都是N<br>然后我们更新它们为Y，然后重启mysql</p>\n<p>update mysql.user set Grant_priv=’Y’,Super_priv=’Y’ where user = ‘root’ and host = ‘%’;</p>\n<h2 id=\"mysql5-7简单密码错误\"><a href=\"#mysql5-7简单密码错误\" class=\"headerlink\" title=\"mysql5.7简单密码错误\"></a>mysql5.7简单密码错误</h2><p>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</p>\n<p>有时候，只是为了自己测试，不想密码设置得那么复杂，譬如只想设置root的密码为123456。</p>\n<p>SET PASSWORD FOR ‘root’@’localhost’ = PASSWORD(‘123456’);</p>\n<p>但是会报错：</p>\n<figure class=\"highlight delphi\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; <span class=\"keyword\">SET</span> PASSWORD <span class=\"keyword\">FOR</span> <span class=\"string\">'root'</span>@<span class=\"string\">'localhost'</span> = PASSWORD(<span class=\"string\">'123'</span>);</span><br><span class=\"line\">ERROR <span class=\"number\">1819</span> (HY000): Your password does <span class=\"keyword\">not</span> satisfy the current policy requirements</span><br></pre></td></tr></table></figure>\n<p>【原因】</p>\n<p>原来MySQL5.6.6版本之后增加了密码强度验证插件validate_password，相关参数设置的较为严格。<br>使用了该插件会检查设置的密码是否符合当前设置的强度规则，若不满足则拒绝设置。影响的语句和函数有：create user,grant,set password,password(),old password。<br>【解决】</p>\n<p>1） 查看mysql全局参数配置</p>\n<p>该问题其实与mysql的validate_password_policy的值有关。<br>查看一下msyql密码相关的几个全局参数：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; select @@validate_password_policy;</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\">| @@validate_password_policy |</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\">| MEDIUM                     |</span><br><span class=\"line\">+<span class=\"comment\">----------------------------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">1 row in <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br><span class=\"line\">mysql&gt; <span class=\"keyword\">SHOW</span> <span class=\"keyword\">VARIABLES</span> <span class=\"keyword\">LIKE</span> <span class=\"string\">'validate_password%'</span>;</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\">| Variable_name                        | Value  |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\">| validate_password_dictionary_file    |        |</span><br><span class=\"line\">| validate_password_length             | 8      |</span><br><span class=\"line\">| validate_password_mixed_case_count   | 1      |</span><br><span class=\"line\">| validate_password_number_count       | 1      |</span><br><span class=\"line\">| validate_password_policy             | MEDIUM |</span><br><span class=\"line\">| validate_password_special_char_count | 1      |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+--------+</span></span><br><span class=\"line\"></span><br><span class=\"line\">6 rows in <span class=\"keyword\">set</span> (<span class=\"number\">0.08</span> sec)</span><br></pre></td></tr></table></figure>\n<p>2）参数解释</p>\n<p>validate_password_dictionary_file<br>插件用于验证密码强度的字典文件路径。</p>\n<p>validate_password_length<br>密码最小长度，参数默认为8，它有最小值的限制，最小值为：validate_password_number_count + validate_password_special_char_count + (2 * validate_password_mixed_case_count)</p>\n<p>validate_password_mixed_case_count<br>密码至少要包含的小写字母个数和大写字母个数。</p>\n<p>validate_password_number_count<br>密码至少要包含的数字个数。</p>\n<p>validate_password_policy<br>密码强度检查等级，0/LOW、1/MEDIUM、2/STRONG。有以下取值：<br><strong>Policy         Tests Performed</strong><br>0 or LOW        Length<br>1 or MEDIUM     Length; numeric, lowercase/uppercase, and special characters<br>2 or STRONG     Length; numeric, lowercase/uppercase, and special characters; dictionary file<br>默认是1，即MEDIUM，所以刚开始设置的密码必须符合长度，且必须含有数字，小写或大写字母，特殊字符。</p>\n<p>validate_password_special_char_count<br>密码至少要包含的特殊字符数。</p>\n<p>3）修改mysql参数配置</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; set global validate_password_policy=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.05 sec)</span><br><span class=\"line\">mysql&gt; </span><br><span class=\"line\">mysql&gt; set global validate_password_mixed_case_count=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_number_count=3;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_special_char_count=0;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; set global validate_password_length=3;</span><br><span class=\"line\">Query OK, 0 rows affected (0.00 sec)</span><br><span class=\"line\">mysql&gt; SHOW VARIABLES LIKE 'validate_password%';</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">| Variable_name                        | Value |</span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">| validate_password_dictionary_file    |       |</span><br><span class=\"line\">| validate_password_length             | 3     |</span><br><span class=\"line\">| validate_password_mixed_case_count   | 0     |</span><br><span class=\"line\">| validate_password_number_count       | 3     |</span><br><span class=\"line\">| validate_password_policy             | LOW   |</span><br><span class=\"line\">| validate_password_special_char_count | 0     |</span><br><span class=\"line\"></span><br><span class=\"line\">+<span class=\"comment\">--------------------------------------+-------+</span></span><br><span class=\"line\">6 rows in <span class=\"keyword\">set</span> (<span class=\"number\">0.00</span> sec)</span><br></pre></td></tr></table></figure>\n<p>4）修改简单密码：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mysql&gt; SET PASSWORD FOR 'root'@'localhost' = PASSWORD('123');</span><br><span class=\"line\">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure>\n<h2 id=\"ERR-1273-Unknown-collation-‘utf8mb4-0900-ai-ci’\"><a href=\"#ERR-1273-Unknown-collation-‘utf8mb4-0900-ai-ci’\" class=\"headerlink\" title=\"[ERR] 1273 - Unknown collation: ‘utf8mb4_0900_ai_ci’\"></a>[ERR] 1273 - Unknown collation: ‘utf8mb4_0900_ai_ci’</h2><p>使用navicate12运行sql文件出错</p>\n<p>报错：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ERR] 1273 - Unknown collation: &#39;utf8mb4_0900_ai_ci&#39;</span><br></pre></td></tr></table></figure>\n<p>报错原因：<br>生成转储文件的数据库版本为8.0,要导入sql文件的数据库版本为5.6,因为是高版本导入到低版本，引起1273错误</p>\n<p>解决方法：<br>打开sql文件，将文件中的所有<br><code>utf8mb4_0900_ai_ci</code>替换为<code>utf8_general_ci</code><br><code>utf8mb4</code>替换为<code>utf8</code><br>保存后再次运行sql文件，运行成功</p>\n<h2 id=\"MySQL报错：Server-returns-invalid-timezone-Go-to-‘Advanced’-tab-and-set-‘serverTimezone’-property-manually\"><a href=\"#MySQL报错：Server-returns-invalid-timezone-Go-to-‘Advanced’-tab-and-set-‘serverTimezone’-property-manually\" class=\"headerlink\" title=\"MySQL报错：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.\"></a>MySQL报错：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.</h2><p>错误：Server returns invalid timezone. Go to ‘Advanced’ tab and set ‘serverTimezone’ property manually.<br>　　　　服务器返回无效时区。转到“高级”选项卡并手动设置“serverTimezone”属性。</p>\n<p>mysql -u root -p<br>mysql&gt;show variables like ‘%time_zone%’;<br>mysql&gt;set global time_zone=’+8:00’;</p>\n<p>问题：每次重启服务都要重新配置一遍。<br>解决：mysql&gt;set persist time_zone=’+8:00’;</p>\n<h2 id=\"mysql-报错：1140-In-aggregated-query-without-GROUP-BY-expression\"><a href=\"#mysql-报错：1140-In-aggregated-query-without-GROUP-BY-expression\" class=\"headerlink\" title=\"mysql 报错：1140 In aggregated query without GROUP BY, expression\"></a>mysql 报错：1140 In aggregated query without GROUP BY, expression</h2><p>1140 In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column ‘football.order.id’; this is incompatible with sql_mode=only_full_group_by<br>mysql5.7执行sql语句报错：In aggregated query without GROUP BY, expression #1 of SELECT list contains nonaggregated column ‘football.order.id’; this is incompatible with sql_mode=only_full_group_by</p>\n<p>找了好久找到可行的办法分享下</p>\n<p>1.方法1，需要重启mysql服务</p>\n<p>编辑/etc/my.cnf文件，加入如下参数，重启mysql</p>\n<blockquote>\n<p>sql_mode = “STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER”</p>\n</blockquote>\n<p>2.方法2，不需要重启mysql服务</p>\n<p>可以看到模式为only_full_group_by</p>\n<p>mysql&gt;show variables like ‘%sql_mode’;</p>\n<p>mysql&gt; show session variables like ‘%sql_mode%’;</p>\n<p>mysql&gt; show global variables like ‘%sql_mode%’;</p>\n<p>使当前会话失效</p>\n<p>mysql&gt; set global sql_mode=’ ‘;</p>\n<p>mysql&gt; set session sql_mode=’ ‘;</p>","next":{"title":"SpringBoot集成WebSocket通信","path":"api/articles/resource-Spring-SpringBoot-SpringBoot集成WebSocket通信.json","image":"/img/header_img/17.gif","num_read":1356,"num_like":916,"num_collection":655,"num_comments":86},"prev":{"title":"java设计模式之桥接模式","path":"api/articles/resource-designpattern-structure-Bridge.json","image":"/img/header_img/Design/Bridge.png","num_read":279,"num_like":735,"num_collection":310,"num_comments":112},"categories":[{"name":"数据库","path":"api/categories/数据库.json","pathContent":"api/categories/数据库","description":"结构化存储格式+事务和并发控制+内存管理+SQL访问接口","cover":"https://sunfy9.gitee.io/project/photo/project/db.jpg"}],"tags":[{"name":"MySQL","path":"api/tags/MySQL.json","pathContent":"api/tags/MySQL","description":"一种关系型数据库管理系统","cover":"https://sunfy9.gitee.io/project/photo/project/desk.jpg"}]}