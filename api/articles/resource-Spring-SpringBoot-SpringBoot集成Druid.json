{"title":"SpringBoot集成Druid","num_read":729,"num_like":702,"num_collection":340,"num_comments":246,"slug":"resource-Spring-SpringBoot-SpringBoot集成Druid","date":"2020-10-11T16:00:00.000Z","img":"/img/header_img/spring/springDruid.png","format":"gallery","_id":"cl8dsxq9s001960lgcpkufu6o","project":"Spring","subtitle":"Apache Druid是一个高性能的实时分析数据库","hot":"read","site":{"data":{}},"updated":"2022-09-20T02:20:00.648Z","author":"Sunfy","comments":true,"path":"api/articles/resource-Spring-SpringBoot-SpringBoot集成Druid.json","webPath":"2020/10/12/resource-Spring-SpringBoot-SpringBoot集成Druid/","permalink":"https://sunfy9.gitee.io/2020/10/12/resource-Spring-SpringBoot-SpringBoot%E9%9B%86%E6%88%90Druid/","excerpt":"SpringBoot 自动集成starter使用实例，SpringBoot自定义集成Druid。Apache Druid是一个高性能的实时分析数据库。druid官网","covers":["../../../../img/SpringBoot集成Druid/image-20210120090838570.png","../../../../img/SpringBoot集成Druid/image-20210120092042057.png","../../../../img/SpringBoot集成Druid/image-20210120092107600.png","../../../../img/SpringBoot集成Druid/image-20210120101026229.png","../../../../img/SpringBoot集成Druid/image-20210120101235996.png","../../../../img/SpringBoot集成Druid/image-20210120101408857.png"],"keywords":"sunfy, hexo-theme-snail","content":"<p>SpringBoot 自动集成starter使用实例，SpringBoot自定义集成Druid。Apache Druid是一个高性能的实时分析数据库。</p>\n<p><a href=\"https://druid.apache.org/\" target=\"_blank\" rel=\"noopener\">druid官网</a><a id=\"more\"></a></p>\n<h2 id=\"1、druid简介\"><a href=\"#1、druid简介\" class=\"headerlink\" title=\"1、druid简介\"></a>1、druid简介</h2><p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120090838570.png\" alt=\"image-20210120090838570\"></p>\n<h2 id=\"2、页面展示\"><a href=\"#2、页面展示\" class=\"headerlink\" title=\"2、页面展示\"></a>2、页面展示</h2><p>集成后访问链接<code>127.0.0.1:8080/druid</code></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120092042057.png\" alt=\"image-20210120092042057\"></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120092107600.png\" alt=\"image-20210120092107600\"></p>\n<h2 id=\"3、手动集成\"><a href=\"#3、手动集成\" class=\"headerlink\" title=\"3、手动集成\"></a>3、手动集成</h2><p>创建一个SpringBoot项目，按照SpringBoot常规的三个步骤进行</p>\n<h3 id=\"1-引入依赖\"><a href=\"#1-引入依赖\" class=\"headerlink\" title=\"1. 引入依赖\"></a>1. 引入依赖<sunfy-line></h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--JDBC，数据库链接最基础--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--web--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--手动导入druid--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--当前使用数据库驱动包--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-添加配置\"><a href=\"#2-添加配置\" class=\"headerlink\" title=\"2.  添加配置\"></a>2.  添加配置</h3><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 数据源</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://192.168.88.88:3306/springboot_mybatis?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"comment\">#   数据源其他配置</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">minEvictableIdleTimeMillis:</span> <span class=\"number\">300000</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">testOnBorrow:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">testOnReturn:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">poolPreparedStatements:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class=\"line\">    <span class=\"attr\">filters:</span> <span class=\"string\">stat,wall</span></span><br><span class=\"line\">    <span class=\"attr\">maxPoolPreparedStatementPerConnectionSize:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">useGlobalDataSourceStat:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">connectionProperties:</span> <span class=\"string\">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class=\"line\">    <span class=\"comment\">#初始化时运行sql脚本</span></span><br><span class=\"line\">    <span class=\"attr\">schema:</span> <span class=\"string\">classpath:sql/schema.sql</span></span><br><span class=\"line\">    <span class=\"attr\">initialization-mode:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-添加注解-业务逻辑\"><a href=\"#3-添加注解-业务逻辑\" class=\"headerlink\" title=\"3. 添加注解/业务逻辑\"></a>3. 添加注解/业务逻辑</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnProperty</span>(<span class=\"string\">\"spring.datasource.type\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidConfiguration</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">         <span class=\"comment\">// 根据配置动态构建一个DataSource，这个方式是DataSourceProperties独有的</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServletRegistrationBean <span class=\"title\">statViewServlet</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRegistrationBean servletRegistrationBean = <span class=\"keyword\">new</span> ServletRegistrationBean();</span><br><span class=\"line\">        servletRegistrationBean.setServlet(<span class=\"keyword\">new</span> StatViewServlet());</span><br><span class=\"line\">        servletRegistrationBean.addUrlMappings(<span class=\"string\">\"/druid/*\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 添加IP白名单</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"allow\"</span>, <span class=\"string\">\"127.0.0.1\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 添加控制台管理用户</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"loginUsername\"</span>, <span class=\"string\">\"admin\"</span>);</span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"loginPassword\"</span>, <span class=\"string\">\"123456\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 是否能够重置数据</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"resetEnable\"</span>, <span class=\"string\">\"false\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> servletRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> FilterRegistrationBean <span class=\"title\">statFilter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        FilterRegistrationBean filterRegistrationBean = <span class=\"keyword\">new</span> FilterRegistrationBean();</span><br><span class=\"line\">        filterRegistrationBean.setFilter(<span class=\"keyword\">new</span> WebStatFilter());</span><br><span class=\"line\">        <span class=\"comment\">// 添加过滤规则</span></span><br><span class=\"line\">        filterRegistrationBean.addUrlPatterns(<span class=\"string\">\"/*\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 忽略过滤格式</span></span><br><span class=\"line\">        filterRegistrationBean.addInitParameter(<span class=\"string\">\"exclusions\"</span>, <span class=\"string\">\"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*,\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> filterRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4、Data-Source数据注入\"><a href=\"#4、Data-Source数据注入\" class=\"headerlink\" title=\"4、Data Source数据注入\"></a>4、Data Source数据注入</h2><h3 id=\"1-ConfigurationProperties注解\"><a href=\"#1-ConfigurationProperties注解\" class=\"headerlink\" title=\"1. @ConfigurationProperties注解\"></a>1. <code>@ConfigurationProperties</code>注解</h3><ul>\n<li>该注解可以使用在类上，则该类下对应的属性会自动注入配置文件中配置信息</li>\n<li>同样该类也可以使用在方法上，在方法中new 对象同样可以自动注入，前提是该方法必须注册为Bean对象（即添加@Bean注解）</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties</span>(prefix = <span class=\"string\">\"spring.datasource\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//        DruidDataSource druidDataSource = new DruidDataSource();</span></span><br><span class=\"line\">    <span class=\"comment\">//        druidDataSource.setMinIdle(1);</span></span><br><span class=\"line\">    <span class=\"comment\">// new的druidDataSource中存在配置文件中配置信息的set方法，可以直接返回new 对象，就可以注入</span></span><br><span class=\"line\">    <span class=\"comment\">// 添加@ConfigurationProperties注解会将配置文件中的信息自动注入在DruidDataSource对象中</span></span><br><span class=\"line\">    <span class=\"comment\">// 这种方法可以很灵活的应用到各个场景</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DruidDataSource();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-DataSourceProperties\"><a href=\"#2-DataSourceProperties\" class=\"headerlink\" title=\"2.DataSourceProperties\"></a>2.<code>DataSourceProperties</code></h3><p><code>DataSourceProperties</code>对象提供的方法<code>initializeDataSourceBuilder</code></p>\n<p>配置文件中的属性都是引用的该方法，<code>initializeDataSourceBuilder</code>的作用就是帮我们去构建一个<code>DataSource</code>对象。该方法采用了建造者的设计模式，一般建造者模式都有一个build方法创建相应对象。</p>\n<ul>\n<li>此方法为<code>DataSourceProperties</code>独有的方法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据配置动态构建一个DataSource，这个方式是DataSourceProperties独有的</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5、配置类注解说明\"><a href=\"#5、配置类注解说明\" class=\"headerlink\" title=\"5、配置类注解说明\"></a>5、配置类注解说明</h2><ul>\n<li>@Configuration：标注当前类为配置类，SpringBoot启动扫描就可以扫描到当前类</li>\n<li><code>@ConditionalOnProperty(&quot;spring.datasource.type&quot;)</code>： 配置当前对象必须在配置spring.datasource.type后该类才会生效</li>\n<li>两个注解在SpringBoot的各个Starter中是不可或缺的</li>\n</ul>\n<h2 id=\"6、官方Starter\"><a href=\"#6、官方Starter\" class=\"headerlink\" title=\"6、官方Starter\"></a>6、官方Starter</h2><p>经过上面的一番配置，我们实现了想要的功能，我们实现的功能也就是Druid Starter中所具备的功能，接下来我们在有上面自定义配置的基础上看下官方提供的Starter又是如何实现的呢？</p>\n<h3 id=\"1-添加注解\"><a href=\"#1-添加注解\" class=\"headerlink\" title=\"1. 添加注解\"></a>1. 添加注解</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--可以去掉手动配置时引入的druid包</span></span><br><span class=\"line\"><span class=\"comment\">&lt;dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;artifactId&gt;druid&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;version&gt;1.2.3&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;/dependency&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--导入druid starter--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-添加配置-1\"><a href=\"#2-添加配置-1\" class=\"headerlink\" title=\"2. 添加配置\"></a>2. 添加配置</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">druid:</span></span><br><span class=\"line\">      <span class=\"comment\">#开启druid 监控台servlet</span></span><br><span class=\"line\">      <span class=\"attr\">stat-view-servlet:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">login-username:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">        <span class=\"attr\">loginPassword:</span> <span class=\"number\">123456</span></span><br><span class=\"line\">      <span class=\"comment\">#开启druid 监控filter</span></span><br><span class=\"line\">      <span class=\"attr\">web-stat-filter:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p>同我们手动配置时一样，配置</p>\n<ul>\n<li>开启druid监控台</li>\n<li>启用druid监控filter</li>\n</ul>\n<h3 id=\"3-注释自定义配置\"><a href=\"#3-注释自定义配置\" class=\"headerlink\" title=\"3. 注释自定义配置\"></a>3. 注释自定义配置</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//@Configuration</span></span><br><span class=\"line\"><span class=\"comment\">//@ConditionalOnProperty(\"spring.datasource.type\")</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>\n<p>注释掉自定义配置，则我们的自定义配置则全部不会生效。</p>\n<h3 id=\"4-启动项目\"><a href=\"#4-启动项目\" class=\"headerlink\" title=\"4. 启动项目\"></a>4. 启动项目</h3><p>此时启动项目，durid控制台依然是可以正常访问的。这样我们就可以很好的理解和体会SpringBoot的开箱即用</p>\n<h3 id=\"5-Starter配置文件\"><a href=\"#5-Starter配置文件\" class=\"headerlink\" title=\"5. Starter配置文件\"></a>5. Starter配置文件</h3><p>使用我们学到了，具体的Starter中又是如何配置的呢，看配置</p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101026229.png\" alt=\"image-20210120101026229\"></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101235996.png\" alt=\"image-20210120101235996\"></p>\n<p>从这我们可以看出我们配置文件中配置的开启druid控制台，必须配置<code>spring.datasource.druid.stat-view-servlet.enabled</code>属性为true，才可以生效</p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101408857.png\" alt=\"image-20210120101408857\"></p>\n<p>配置druid拦截器，都也是同样的原理</p>\n<h2 id=\"7、总结\"><a href=\"#7、总结\" class=\"headerlink\" title=\"7、总结\"></a>7、总结</h2><p>通过durid这个插件，自定义与SpringBoot集成以及直接引入Starter两种方式，体验Springboot将我们常用的场景抽取成starter(场景启动器)后给我们带来的便利。体验SpringBoot的开箱即用的便捷的同时，又了解starter具体的实现原理，让我们不至于成为一个简单的操作机器，知其然而知其所以然。</p>\n","more":"</p>\n<h2 id=\"1、druid简介\"><a href=\"#1、druid简介\" class=\"headerlink\" title=\"1、druid简介\"></a>1、druid简介</h2><p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120090838570.png\" alt=\"image-20210120090838570\"></p>\n<h2 id=\"2、页面展示\"><a href=\"#2、页面展示\" class=\"headerlink\" title=\"2、页面展示\"></a>2、页面展示</h2><p>集成后访问链接<code>127.0.0.1:8080/druid</code></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120092042057.png\" alt=\"image-20210120092042057\"></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120092107600.png\" alt=\"image-20210120092107600\"></p>\n<h2 id=\"3、手动集成\"><a href=\"#3、手动集成\" class=\"headerlink\" title=\"3、手动集成\"></a>3、手动集成</h2><p>创建一个SpringBoot项目，按照SpringBoot常规的三个步骤进行</p>\n<h3 id=\"1-引入依赖\"><a href=\"#1-引入依赖\" class=\"headerlink\" title=\"1. 引入依赖\"></a>1. 引入依赖<sunfy-line></h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--JDBC，数据库链接最基础--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--web--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--手动导入druid--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--当前使用数据库驱动包--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>mysql<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-添加配置\"><a href=\"#2-添加配置\" class=\"headerlink\" title=\"2.  添加配置\"></a>2.  添加配置</h3><figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 数据源</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">xxxx</span></span><br><span class=\"line\">    <span class=\"attr\">url:</span> <span class=\"string\">jdbc:mysql://192.168.88.88:3306/springboot_mybatis?characterEncoding=utf8&amp;useSSL=false&amp;serverTimezone=UTC&amp;</span></span><br><span class=\"line\">    <span class=\"attr\">driver-class-name:</span> <span class=\"string\">com.mysql.cj.jdbc.Driver</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class=\"line\">    <span class=\"comment\">#   数据源其他配置</span></span><br><span class=\"line\">    <span class=\"attr\">initialSize:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">minIdle:</span> <span class=\"number\">5</span></span><br><span class=\"line\">    <span class=\"attr\">maxActive:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">maxWait:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"number\">60000</span></span><br><span class=\"line\">    <span class=\"attr\">minEvictableIdleTimeMillis:</span> <span class=\"number\">300000</span></span><br><span class=\"line\">    <span class=\"attr\">validationQuery:</span> <span class=\"string\">SELECT</span> <span class=\"number\">1</span> <span class=\"string\">FROM</span> <span class=\"string\">DUAL</span></span><br><span class=\"line\">    <span class=\"attr\">testWhileIdle:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">testOnBorrow:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">testOnReturn:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">poolPreparedStatements:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"comment\">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span></span><br><span class=\"line\">    <span class=\"attr\">filters:</span> <span class=\"string\">stat,wall</span></span><br><span class=\"line\">    <span class=\"attr\">maxPoolPreparedStatementPerConnectionSize:</span> <span class=\"number\">20</span></span><br><span class=\"line\">    <span class=\"attr\">useGlobalDataSourceStat:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">connectionProperties:</span> <span class=\"string\">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span></span><br><span class=\"line\">    <span class=\"comment\">#初始化时运行sql脚本</span></span><br><span class=\"line\">    <span class=\"attr\">schema:</span> <span class=\"string\">classpath:sql/schema.sql</span></span><br><span class=\"line\">    <span class=\"attr\">initialization-mode:</span> <span class=\"string\">always</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-添加注解-业务逻辑\"><a href=\"#3-添加注解-业务逻辑\" class=\"headerlink\" title=\"3. 添加注解/业务逻辑\"></a>3. 添加注解/业务逻辑</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnProperty</span>(<span class=\"string\">\"spring.datasource.type\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidConfiguration</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">         <span class=\"comment\">// 根据配置动态构建一个DataSource，这个方式是DataSourceProperties独有的</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> ServletRegistrationBean <span class=\"title\">statViewServlet</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        ServletRegistrationBean servletRegistrationBean = <span class=\"keyword\">new</span> ServletRegistrationBean();</span><br><span class=\"line\">        servletRegistrationBean.setServlet(<span class=\"keyword\">new</span> StatViewServlet());</span><br><span class=\"line\">        servletRegistrationBean.addUrlMappings(<span class=\"string\">\"/druid/*\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 添加IP白名单</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"allow\"</span>, <span class=\"string\">\"127.0.0.1\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 添加控制台管理用户</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"loginUsername\"</span>, <span class=\"string\">\"admin\"</span>);</span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"loginPassword\"</span>, <span class=\"string\">\"123456\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 是否能够重置数据</span></span><br><span class=\"line\">        servletRegistrationBean.addInitParameter(<span class=\"string\">\"resetEnable\"</span>, <span class=\"string\">\"false\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> servletRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> FilterRegistrationBean <span class=\"title\">statFilter</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        FilterRegistrationBean filterRegistrationBean = <span class=\"keyword\">new</span> FilterRegistrationBean();</span><br><span class=\"line\">        filterRegistrationBean.setFilter(<span class=\"keyword\">new</span> WebStatFilter());</span><br><span class=\"line\">        <span class=\"comment\">// 添加过滤规则</span></span><br><span class=\"line\">        filterRegistrationBean.addUrlPatterns(<span class=\"string\">\"/*\"</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 忽略过滤格式</span></span><br><span class=\"line\">        filterRegistrationBean.addInitParameter(<span class=\"string\">\"exclusions\"</span>, <span class=\"string\">\"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*,\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> filterRegistrationBean;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4、Data-Source数据注入\"><a href=\"#4、Data-Source数据注入\" class=\"headerlink\" title=\"4、Data Source数据注入\"></a>4、Data Source数据注入</h2><h3 id=\"1-ConfigurationProperties注解\"><a href=\"#1-ConfigurationProperties注解\" class=\"headerlink\" title=\"1. @ConfigurationProperties注解\"></a>1. <code>@ConfigurationProperties</code>注解</h3><ul>\n<li>该注解可以使用在类上，则该类下对应的属性会自动注入配置文件中配置信息</li>\n<li>同样该类也可以使用在方法上，在方法中new 对象同样可以自动注入，前提是该方法必须注册为Bean对象（即添加@Bean注解）</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties</span>(prefix = <span class=\"string\">\"spring.datasource\"</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//        DruidDataSource druidDataSource = new DruidDataSource();</span></span><br><span class=\"line\">    <span class=\"comment\">//        druidDataSource.setMinIdle(1);</span></span><br><span class=\"line\">    <span class=\"comment\">// new的druidDataSource中存在配置文件中配置信息的set方法，可以直接返回new 对象，就可以注入</span></span><br><span class=\"line\">    <span class=\"comment\">// 添加@ConfigurationProperties注解会将配置文件中的信息自动注入在DruidDataSource对象中</span></span><br><span class=\"line\">    <span class=\"comment\">// 这种方法可以很灵活的应用到各个场景</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> DruidDataSource();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-DataSourceProperties\"><a href=\"#2-DataSourceProperties\" class=\"headerlink\" title=\"2.DataSourceProperties\"></a>2.<code>DataSourceProperties</code></h3><p><code>DataSourceProperties</code>对象提供的方法<code>initializeDataSourceBuilder</code></p>\n<p>配置文件中的属性都是引用的该方法，<code>initializeDataSourceBuilder</code>的作用就是帮我们去构建一个<code>DataSource</code>对象。该方法采用了建造者的设计模式，一般建造者模式都有一个build方法创建相应对象。</p>\n<ul>\n<li>此方法为<code>DataSourceProperties</code>独有的方法</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> DataSource <span class=\"title\">dataSource</span><span class=\"params\">(DataSourceProperties properties)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 根据配置动态构建一个DataSource，这个方式是DataSourceProperties独有的</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5、配置类注解说明\"><a href=\"#5、配置类注解说明\" class=\"headerlink\" title=\"5、配置类注解说明\"></a>5、配置类注解说明</h2><ul>\n<li>@Configuration：标注当前类为配置类，SpringBoot启动扫描就可以扫描到当前类</li>\n<li><code>@ConditionalOnProperty(&quot;spring.datasource.type&quot;)</code>： 配置当前对象必须在配置spring.datasource.type后该类才会生效</li>\n<li>两个注解在SpringBoot的各个Starter中是不可或缺的</li>\n</ul>\n<h2 id=\"6、官方Starter\"><a href=\"#6、官方Starter\" class=\"headerlink\" title=\"6、官方Starter\"></a>6、官方Starter</h2><p>经过上面的一番配置，我们实现了想要的功能，我们实现的功能也就是Druid Starter中所具备的功能，接下来我们在有上面自定义配置的基础上看下官方提供的Starter又是如何实现的呢？</p>\n<h3 id=\"1-添加注解\"><a href=\"#1-添加注解\" class=\"headerlink\" title=\"1. 添加注解\"></a>1. 添加注解</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--可以去掉手动配置时引入的druid包</span></span><br><span class=\"line\"><span class=\"comment\">&lt;dependency&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;artifactId&gt;druid&lt;/artifactId&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;version&gt;1.2.3&lt;/version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;/dependency&gt;--&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--导入druid starter--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>druid-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-添加配置-1\"><a href=\"#2-添加配置-1\" class=\"headerlink\" title=\"2. 添加配置\"></a>2. 添加配置</h3><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">druid:</span></span><br><span class=\"line\">      <span class=\"comment\">#开启druid 监控台servlet</span></span><br><span class=\"line\">      <span class=\"attr\">stat-view-servlet:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">login-username:</span> <span class=\"string\">admin</span></span><br><span class=\"line\">        <span class=\"attr\">loginPassword:</span> <span class=\"number\">123456</span></span><br><span class=\"line\">      <span class=\"comment\">#开启druid 监控filter</span></span><br><span class=\"line\">      <span class=\"attr\">web-stat-filter:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n<p>同我们手动配置时一样，配置</p>\n<ul>\n<li>开启druid监控台</li>\n<li>启用druid监控filter</li>\n</ul>\n<h3 id=\"3-注释自定义配置\"><a href=\"#3-注释自定义配置\" class=\"headerlink\" title=\"3. 注释自定义配置\"></a>3. 注释自定义配置</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//@Configuration</span></span><br><span class=\"line\"><span class=\"comment\">//@ConditionalOnProperty(\"spring.datasource.type\")</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DruidConfiguration</span> </span>&#123;</span><br></pre></td></tr></table></figure>\n<p>注释掉自定义配置，则我们的自定义配置则全部不会生效。</p>\n<h3 id=\"4-启动项目\"><a href=\"#4-启动项目\" class=\"headerlink\" title=\"4. 启动项目\"></a>4. 启动项目</h3><p>此时启动项目，durid控制台依然是可以正常访问的。这样我们就可以很好的理解和体会SpringBoot的开箱即用</p>\n<h3 id=\"5-Starter配置文件\"><a href=\"#5-Starter配置文件\" class=\"headerlink\" title=\"5. Starter配置文件\"></a>5. Starter配置文件</h3><p>使用我们学到了，具体的Starter中又是如何配置的呢，看配置</p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101026229.png\" alt=\"image-20210120101026229\"></p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101235996.png\" alt=\"image-20210120101235996\"></p>\n<p>从这我们可以看出我们配置文件中配置的开启druid控制台，必须配置<code>spring.datasource.druid.stat-view-servlet.enabled</code>属性为true，才可以生效</p>\n<p><img src=\"../../../../img/SpringBoot集成Druid/image-20210120101408857.png\" alt=\"image-20210120101408857\"></p>\n<p>配置druid拦截器，都也是同样的原理</p>\n<h2 id=\"7、总结\"><a href=\"#7、总结\" class=\"headerlink\" title=\"7、总结\"></a>7、总结</h2><p>通过durid这个插件，自定义与SpringBoot集成以及直接引入Starter两种方式，体验Springboot将我们常用的场景抽取成starter(场景启动器)后给我们带来的便利。体验SpringBoot的开箱即用的便捷的同时，又了解starter具体的实现原理，让我们不至于成为一个简单的操作机器，知其然而知其所以然。</p>","next":{"title":"SpringBoot自定义staters","path":"api/articles/resource-Spring-SpringBoot-SpringBoot自定义staters.json","image":"/img/header_img/spring/springstaters.PNG","num_read":325,"num_like":39,"num_collection":699,"num_comments":183},"prev":{"title":"Spring推断构造方法","path":"api/articles/resource-Spring-Spring-Spring推断构造方法.json","image":"/img/header_img/spring/constructor.png","num_read":1220,"num_like":900,"num_collection":708,"num_comments":80},"categories":[{"name":"Spring全家桶","path":"api/categories/Spring全家桶.json","pathContent":"api/categories/Spring全家桶","description":"更快、更容易、更安全","cover":"https://sunfy9.gitee.io/project/photo/project/spring.png"}],"tags":[{"name":"SpringBoot","path":"api/tags/SpringBoot.json","pathContent":"api/tags/SpringBoot","description":"更快、更容易、更安全","cover":"https://sunfy9.gitee.io/project/photo/project/spring.png"}]}